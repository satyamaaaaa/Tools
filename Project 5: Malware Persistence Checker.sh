#!/bin/bash

echo "=============================================="
echo " Project 5: Malware Persistence Checker"
echo "=============================================="
echo

# Root check
if [ "$EUID" -ne 0 ]; then
    echo "[!] Please run as root (sudo)"
    exit 1
fi

OUT="persistence_report_$(date +%Y-%m-%d_%H-%M).txt"
SUCCESS=1

# -------- CRON JOBS --------
echo "[+] Checking cron jobs"
echo "=== CRON JOBS ===" > "$OUT"

crontab -l 2>/dev/null >> "$OUT"
if [ $? -ne 0 ]; then
    echo "No user cron jobs found" >> "$OUT"
fi

# -------- SYSTEMD SERVICES --------
echo "[+] Checking systemd services"
echo "" >> "$OUT"
echo "=== SYSTEMD SERVICES ===" >> "$OUT"

systemctl list-unit-files --type=service >> "$OUT"
if [ $? -ne 0 ]; then
    SUCCESS=0
fi

# -------- INIT.D SCRIPTS --------
echo "[+] Checking init.d startup scripts"
echo "" >> "$OUT"
echo "=== INIT.D SCRIPTS ===" >> "$OUT"

ls -l /etc/init.d >> "$OUT"
if [ $? -ne 0 ]; then
    SUCCESS=0
fi

# -------- FINAL STATUS --------
if [ "$SUCCESS" -eq 1 ]; then
    echo
    echo "=============================================="
    echo " ✅ Project 5 Completed Successfully"
    echo " Persistence report saved as:"
    echo " $OUT"
    echo "=============================================="
else
    echo
    echo "[!] Project 5 failed — persistence check incomplete"
    exit 1
fi
